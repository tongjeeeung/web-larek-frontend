# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Базовый код

1. Класс EventEmitter

Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков
о наступлении события.
Класс имеет методы ```on ```, ```off``` ,```emit``` — для подписки на событие, отписки от события и уведомления
подписчиков о наступлении события соответственно.
Дополнительно реализованы методы ```onAll``` и ```offAll``` — для подписки на все события и сброса всех
подписчиков.
Интересным дополнением является метод ```trigger``` , генерирующий заданное событие с заданными
аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти
классы будут генерировать события, не будучи при этом напрямую зависимыми от
класса ```EventEmitter```.

2. Класс Api

Позволяет получать объект с сервера при запросе, работает с ответами сервера.
Класс имеет методы ```get``` и ```post``` для отправления и получения запросов на сервер.

3. Класс ApiShop

Реализует изменения данных для получения их в удобном ввиде.
Класс имеет методы ```getCardsArr```, ```getCardItem``` и ```postCard``` для отправки и получения ответов с сервера используя родительский класс ```Api```.

## Компоненты модели данных (бизнес-логика)

1. Класс AppState

Класс реализует работу с данными приложения.
Содержит значения данных, таких как: ```basket``` - массив элементов корзины, ```catalog``` - массив элементов каталога, ```order``` - объект хронящий данные пользователя и заказа.

```
basket: string[]: // хранит список товаров в корзине
catalog: ICard[] // хранит данные о товарах
order: IOrder = { // хранит данные о заказе
  email: '', // адрес почты покупателя
  phone: '', // телефон покупателя
  address: '', // адрес покупателя
  payment: '', // способ оплаты
  total: 0, // сумма заказа
  items: [] // содержимое заказа
};

```

Имеет методы:
 ```setCatalog```, ```setBasket```, ```setOrderInfo``` - для сохранения данных.
 ```getOrder```, ```getBasket```, ```getCurrentCard``` - для получения сохраненных данных.
 ```clearBasket``` - дополнительный метод для работы с данными.

## Компоненты представления

1. Класс Page

Класс отвечает за визуальное отображение на главной странице, таких как корзина товаров со счетчиком,контейнер с карточками товаров, контейнер для отображения модальных окон.
Навешивает слушатели на визуальные кнопки элементов страницы, используя родительский класс ```EventEmitter```.

Класс имеет сеттеры для изменения следующих элементов:
```counter``` - для изменения количества товаров в корзине.
```catalogContainer``` - для отображения карточек товаров на странице.
```popupContainer``` - для отображения модальных окон.

2. Класс Card

Работает с ```Template``` элементами страницы, насышая контентом, устанавливает слушатели с помощью родительского класса ```EventEmitter```. 
Метод ```render``` получает информацию о продукте и возвращает готовый html-элемент.
Метод ```buyButtonView``` - для корректного отображения кнопки покупики. Свойство ```id``` для хранения идентификатора товара.

3. Класс Basket

Класс работает с ```Template``` элементом страницы, устанавливает слушатель с помощью родительского класса ```EventEmitter```.
Метод ```render``` для отоброжения всей корзины, принимет список элементов списка корзины и польную стоимость товаров.

4. Класс Form

Класс для добавления форм в контейнер, считывания информации пользователя для дальнейшей передачи.
Реализует методы: 
```render``` - возвращает форм элемент, для дальнейшего использования.
```getOrderFromForm``` - отдает информацию о вводе пользователя после ```submit```.
```setOrderFromForm``` - внутреняя функция для сохранений информации пользователя после ```submit```.
```clearValue``` - функция для очистки форм, для последующего улучшения приложения.
```setForce```- внутрение метод формы для отоброжения выбранной кнопки.

5. Класс approvalOrderView

Класс реализует работу с ```template``` элементами, для вывода конечной суммы, и подтверждения покупки пользователя.
Метод ```render``` возвращает измененный html-элемент страницы для последущего вывода.

6. Класс Popup

Класс реализует работу с DOM-элементами, для отоброжения на странице модальных окон, имеет методы: 
```open``` - для отображения модального окна на странице.
```close``` - для скрытия модального окна.

## Контролер

1. Активный слушатель catalog:changed

Нужен для вызова функции ```renderCatalog```. Пренадлежит глобальному экземпляру класса ```AppState```.

2. Активный слушатель modal:open

Нужен для блокировки прокрутки страницы, через экземпляр глобального класса ```Page```. Принадлежит глобальному экземпляру класса ```Popup```.

3. Активный слушатель modal:close

Нужен для разблокировки прокрутки страницы, через экземпляр глобального класса ```Page```. Принадлежит глобальному экземпляру класса ```Popup```.

4. Функция renderCatalog

Преднозначена для создания экземпляров классов и последующей передачей в контейнер отображения в каталоге.
Использует ранее созданый экземепляр класса ```Page``` для использования сеттера ```catalogContainer``` включая слушатель события ```basket:open```, который принимает функцию ```handleOpenBasket```. Сеттер принимает в себя массив html-элементов. Получучившийся массив реализуется с помощью экземпляра класса ```Card``` внутри которого навешиваются слушатели события ```card:open``` передавая функцию ```handleOpenPopup```.

5. Функция handleOpenPopup

Эта функция открывает всплывающее окно с карточкой товара, используя переданный объект card типа IViewCard.
Создает экземпляр класса ```Card```, включает слушатель ```card:changed``` с передачей функции ```handleBuyPrew```. Использует ранее созданый экземпляр класса ```Page``` для установки в сеттер ```popupContainer``` карточки товара. Открывает модальное окно с помощью ранее созданого экземпляра класса ```Popup```.

6. Функция handleOpenBasket 

Эта функция открывает всплышающее окно с корзиной товаров, дает возможность удалить из корзины товар или продолжить оформление. Используя такие экземпляры классов, как ```Basket``` для включения слушателя ```form:submit``` передавая функцию ```handleOpenForm```, ```Card``` для карточек внутри списка корзины и навешивания события ```card:changed``` передавая функцию ```handleDeliteCard```, которые передаются в метод ```render``` из экземпляра класса ```Basket```. Взаимодействет с глобально созданным экземпляром класса ```AppState``` для получения данных объекта заказа и внесения изменений по заказу.

7. Функция handleOpenForm

Эта функция создает экземпляр класса ```Form```, меняет на странице модальное окно, добовляя в него формы, включает слушатели передавая функцию перерисовки следующей формы и проверку валидации формы.

8. Функция handleOpenNextForm

Эта функция сохроняет информацию пользователя с предыдущей формы передовая ее в класс ```AppState```. Создает экземепляр класса ```Form```, меняет на странице модальное окно, добовляя в него новые формы, включает слушатели ```form:submit```  передавая функцию отрисовки успешного заказа ```handlePostOrder``` и  ```input:changed``` проверку валидации формы ```validetionForms```.

9. Функция handlePostOrder

Эта функция сохроняет информацию пользователя с предыдущей формы передовая ее в класс ```AppState```.
Делает отправку данных на сервер через класс ```ApiShop```.
Вслучае успешного ответа с сервера, передает в функцию ```approvalOrder``` полную стоимость товаров пришедшую с сервера. Очищает корзину с помощью методов из глобального экземпляра класса ```AppState```. Меняет счетчик корзины через глобальный экземпляр класса ```Page```.

10. Функция approvalOrder

Эта функция перерисовывает модальное окно говоря пользователю об успешной отправки данных на сервер.
Создает экземпляр класса ```approvalOrderView```, включает слушатель ```succes:click``` передавая функция закрытия ```popup```. Перерисовывает модальное окно.

11. Функция validetionForms

Данная функция принимает экземпляр класса ```Form```, проверяет валидность формы через функции ```hasInvalidInput``` и ```cheackCashAndCardValid```.
Меняет атрибут кнопки.

12. Функция hasInvalidInput

Принимает массив html-элементов, проверяет валидацию всех input-элементов. Возвращает boolen значение.

13. Функция cheackCashAndCardValid

Принимает экземпляр класса ```Form```, проверяет наличие кнопок выбора оплаты, в положительном случае, проверяет имеет ли одна из кнопок активный класс. Возвращает boolen значение.

14. Функция handleBuyPrew

Принимает экземпляр класса ```Card```, вызывает функцию ```handleAddDeliteCard``` меняет текст кнопки покупки товара.

15. Функция handleAddDeliteCard

Принимает экземпляр класса ```Card```, через глобальный класс ```AppState``` добавляет ```id``` карточки в список корзины. Меняет счетчик корзины через глобальный класс ```Page```.

16. Функция handleDeliteCard

Принимает экземпляр класса ```Card```, вызывает функции ```handleAddDeliteCard``` и ```handleOpenBasket```.

## Ключивые типы данных

```
// Интерфейс данных товара
export interface ICard {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}

// Интерфейс формы для контакных данных
export interface IOrderForm {
  email: string;
  phone: string;
}

// Интерфейс формы выбора оплаты и адреса
export interface IOrderInfo {
  payment: string;
  address: string; 
}

// Интерфейс данных заказа
export interface IOrder extends IOrderForm, IOrderInfo {
  items: string[];
  total: number;
}

// Интерфейст товара при ответе с сервера
export interface IOrderResult {
  id: string;
  total: number;
}
```